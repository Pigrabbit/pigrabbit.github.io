---
title: Between Client Side Rendering and Server Side Rendering
date: 2020-09-22
tags:
  - Performance
  - Architecture
---

> ì´ ê¸€ì€ **Web at Google I/O 2019** ì˜ 
[*Rendering on the Web: Performance Implications of Application Architecture*](https://youtu.be/k-A2VfuUROg)
ì„¸ì…˜ì„ ë“£ê³  ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤.

Web applicationì˜ ArchitectureëŠ” Component model, Routing and Transtion, Data/state Management ë“±ë„ ê³ ë ¤í•´ì•¼ í•˜ì§€ë§Œ,
ì´ ì„¸ì…˜ì€ **Rendering and loading**ì— ì´ˆì ì„ ë§ì·„ë‹¤.

## The cost of rendering

ìš©ëŸ‰ì´ í° Javascript SPAë¥¼ ë¸Œë¼ìš°ì €ì—ì„œ renderingí•œë‹¤ê³  ê°€ì •í•˜ì.
ê°€ì¥ ë¨¼ì €, HTML skeletonì„ ë°›ê³  í¬í•¨ëœ jsë¥¼ ì‹¤í–‰í•˜ëŠ” ë™ì•ˆ renderingì´ blockëœë‹¤.
ë§ˆì¹¨ë‚´ Javascriptë¥¼ í†µí•´ DOMë“¤ì´ ìƒì„±ë˜ë©° ì™„ì „í•œ web pageë¥¼ ê·¸ë¦¬ê²Œ ëœë‹¤.

ë¸Œë¼ìš°ì €ê°€ HTMLì„ skeletonì„ ë°›ìœ¼ë©´ First PaintëŠ” ë°œìƒí•˜ì§€ë§Œ, 
main Javascript íŒŒì¼ì„ ì‹¤í–‰í•œ ë’¤ DOMì„ ì™„ì „íˆ ìƒì„±í•´ì•¼ì§€ë§Œ First Contentful Paintê°€ ë°œìƒí•˜ëŠ” ê²ƒì´ë‹¤.
ì¼ì •ì‹œê°„ ë’¤ì— web pageê°€ ë¹„ë¡œì†Œ ìœ ì € interactionì„ ë°›ì„ ìˆ˜ ìˆê²Œ ëœë‹¤.(TTI, Time to Interactive)

![Client Side Rendering Progress](./csr-progress.jpg)

ë¬¸ì œëŠ” Javascript bundle íŒŒì¼ì˜ ìš©ëŸ‰ì´ ë¹„ëŒ€í•´ì§ˆ ìˆ˜ë¡ FPë¶€í„° FCPê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„ì´ ëŠ˜ì–´ë‚œë‹¤ëŠ” ì ì´ë‹¤.
ì¦‰ ì‚¬ìš©ìëŠ” web appì„ ë¡œë”©í•˜ëŠ”ë° ì˜¤ë˜ ê¸°ë‹¤ë ¤ì•¼í•˜ê³  Performanceì™€ User experienceì—ì„œ ê·¸ë§Œí¼ ì†í•´ë¥¼ ë³´ê²Œ ëœë‹¤.

## Back to basic

Client Side Renderingì„ í•˜ëŠ” Javascript SPAì˜ bundle ìš©ëŸ‰ì´ ì»¤ì§ì— ë”°ë¼ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ë°, 
ì „í†µì ì¸ ë°©ë²•ì²˜ëŸ¼ Server Side Renderingì„ í•˜ë©´ ì–´ë–¨ê¹Œ?

SSRì€ ë¸Œë¼ìš°ì €ê°€ HTML íŒŒì¼ì„ parsing í•˜ìë§ˆì FCPë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆì„í…Œë‹ˆê¹Œ CSRì˜ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤!
Performanceì—ì„œ ì¥ì ì„ ì–»ì„ ìˆ˜ëŠ” ìˆì§€ë§Œ CSR ê°™ì´ user interactiveí•œ applicationì„ ë§Œë“œëŠ” ë°ëŠ” ì–´ë ¤ì›€ì´ ìˆë‹¤.
SSRì˜ ì„±ëŠ¥ê³¼ CSRì˜ interaction ë‘ ë§ˆë¦¬ í† ë¼ë¥¼ ì¡ì„ ë°©ë²•ì€ ì—†ì„ê¹Œ? (ì¸ê°„ì˜ ìš•ì‹¬ì€ ëì´ì—†ë‹¤ğŸ¤”)

## Server Sider Rendering with (full) hydration

ìµœê·¼ Javascript frameworkë“¤ì€ Server Sider Rendering with hydration ë°©ì‹ì„ ì§€ì›í•œë‹¤.
Reactì˜ ê²½ìš°ëŠ” nodeJS serverì—ì„œ `ReactDOMServer`ì˜ `renderToString` methodë¥¼ ì‚¬ìš©í•´ì„œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
ë˜í•œ, Next.js, Nuxt.js ê°™ì€ meta frameworkë¥¼ ì‚¬ìš©í•˜ë©´ ê°„ë‹¨í•œ ì„¤ì •ìœ¼ë¡œ SSR with hydrationì„ ì ìš©í•  ìˆ˜ ìˆë‹¤.

![Server Side Rendering with Hydration Progress](./ssr-hyd-progress.jpg)

SSR with hydrationì—ì„œëŠ” HTMLì„ íŒŒì‹±í•˜ìë§ˆì í™”ë©´ì„ ë³´ì—¬ì¤„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— FCPê¹Œì§€ ì‹œê°„ì´ ì ê²Œ ê±¸ë¦°ë‹¤.
ê·¸ëŸ¬ë‚˜ ì—¬ì „íˆ bundle js íŒŒì¼ì—†ì´ëŠ” Applicationì´ interactive í•˜ì§€ ì•Šë‹¤.
ê·¸ë ‡ê¸° ë•Œë¬¸ì— FCPë¶€í„° TTIê¹Œì§€ ì‹œê°„ì„ ë‹¨ì¶•í•´ì•¼ í•œë‹¤ëŠ” ê³¼ì œë¥¼ ì—¬ì „íˆ ì•ˆê³  ìˆë‹¤.

## Rendering as a spectrum

Rendering Architectureë“¤ì„ í•˜ë‚˜ì˜ ì¶• ìœ„ì— ì˜¬ë ¤ë‘ê³  ì‚´í´ë³´ì.
ê°€ì¥ ì™¼ìª½ì´ thin client rendering, ê°€ì¥ ì˜¤ë¥¸ìª½ì´ thick client renderingì´ë¼ê³  í•˜ì.

![Rendering spectrum](./rendering-spectrum.jpg)

Performance ì¸¡ë©´ì—ì„œ ê¶ê·¹ì ìœ¼ë¡œ ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê²ƒì€, 
initial contentë¥¼ ë¹¨ë¦¬ clientì— ë³´ë‚´ì£¼ê³  ì‚¬ìš©ìê°€ interaction í•  ë•Œ ê¹Œì§€ ëŒ€ê¸°í•˜ëŠ” ì‹œê°„ì€ ì¤„ì´ëŠ” ê²ƒì´ë‹¤.

#### Prerendering

Prerenderingì€ Serverì— buildëœ HTMLíŒŒì¼ì„ ê°€ì§€ê³  ìˆë‹¤ê°€, clientë¡œë¶€í„° requestê°€ ì™”ì„ ë•Œ ì¦‰ì‹œ ë³´ë‚´ì¤€ë‹¤.
ì´ëŠ” ê¸°ì¡´ SSRì—ì„œ requestê°€ ì™”ì„ ë•Œ, HTMLì„ generateí•˜ëŠ” ë°©ì‹ê³¼ëŠ” ëŒ€ë¹„ëœë‹¤.

First Contentful Paintì—ì„œ ìš°ìœ„ê°€ ìˆìœ¼ë©° SSR overheadê°€ ì ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.
ì´ ë¸”ë¡œê·¸ë¥¼ ì‘ì„±í•˜ê³  ìˆëŠ” Gatsbyê°€ ì˜ˆì‹œ ì¤‘ í•˜ë‚˜ë‹¤.
ë¸”ë¡œê·¸ì— ì“°ì´ëŠ” ê²ƒì—ì„œ ìœ ì¶”í•  ìˆ˜ ìˆë“¯ì´ staticí•œ contentë¥¼ serveí•˜ëŠ”ë°ëŠ” ë¬¸ì œê°€ ì—†ì§€ë§Œ,
user interactionì— ì˜í•´ ë™ì ìœ¼ë¡œ ë³€í•˜ëŠ” pageë¥¼ ì œê³µí•˜ëŠ” ë°ëŠ” í•œê³„ê°€ ìˆë‹¤.

#### Streaming

- multiple requestë¥¼ í•œ ë²ˆì— render
- chunkê°€ ìƒì„±ë˜ìë§ˆì ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆìŒ
- ì „ì²´ HTMLì´ ìƒì„±ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦´ í•„ìš”ì—†ìŒ
- Time to Frist Byte(FFTB) ê°œì„ 

ë‹¤ìŒìœ¼ë¡œ Streamingì€ multiple requestë¥¼ í•œ ë²ˆì— renderí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ
server ì¸¡ì—ì„œ ìš”ì²­ì— ëŒ€í•œ chunkë¥¼ ë§Œë“¤ë©´ ì¦‰ì‹œ Clientë¡œ ì „ì†¡í•´ì¤€ë‹¤.
í˜ì´ì§€ ì „ì²´ì˜ HTML stringì´ ìƒì„±ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ì§€ ì•Šì•„ë„ ë˜ê¸° ë•Œë¬¸ì—
Time to First Byte(FFTB)ë¥¼ ê°œì„ í•  ìˆ˜ ìˆë‹¤.
Reactì—ì„œëŠ” `ReactDOMServer`ì˜ `renderToNodeString`ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ë©´ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

ê·¸ëŸ¬ë‚˜ streamingì´ silver bulletì´ ë  ìˆ˜ëŠ” ì—†ë‹¤.
Conference í˜„ì¬, pageê°€ ì ë‹¹íˆ í¬ì§€ ì•Šìœ¼ë©´(16kB) ì„±ëŠ¥ì˜ í–¥ìƒì„ ëŠë¼ê¸° ì–´ë µë‹¤ê³  í•œë‹¤.

#### Progressive hydration

Code splittingì„ ì‚¬ìš©í•´ í˜ì´ì§€ë¥¼ ì˜ë¯¸ìˆëŠ” ì»´í¬ë„ŒíŠ¸ ê²½ê³„ë¡œ ë‚˜ëˆ„ê³  ìš°ì„ ìˆœìœ„ë¥¼ ë¶€ì—¬í•´ serverì—ì„œ chunkë¥¼ ì „ì†¡í•œë‹¤.
SSR with full hydrationê³¼ ë¹„êµí–ˆì„ ë•Œ,
í˜ì´ì§€ì˜ ë¶€ë¶„ë¶€ë¶„ì„ ë¯¸ë¦¬ ì •ì˜í•´ë‘” ìš°ì„ ìˆœìœ„ì— ë”°ë¼ hydrationì„ ì‹œí‚¤ê¸° ë•Œë¬¸ì—
ê·¸ ë¶€ë¶„ì˜ chunkê°€ ë‹¤ìš´ë¡œë“œ ë¨ì— ë”°ë¼ interactive í•´ì§„ë‹¤ëŠ” ì ì—ì„œ ì°¨ì´ê°€ ìˆë‹¤.
ì‚¬ìš©ìê°€ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì˜ ìš°ì„ ìˆœìœ„ë¥¼ ë†’ê²Œ í•´ë‘”ë‹¤ë©´ User experienceë¥¼ í¬ê²Œ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.
í•„ìš”ì— ë”°ë¼ í˜ì´ì§€ ì „ì²´ì˜ chunkë¥¼ hydrateí•˜ì§€ ì•Šê³  ì§€ì—°ì‹œì¼°ë‹¤ê°€
lazy loading ê¸°ë²•ë“±ìœ¼ë¡œ ì‚¬ìš©ìê°€ ìš”ì²­í•  ë•Œ interactiveí•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

ReactíŒ€ì—ì„œëŠ” [Suspence roadmap](https://reactjs.org/docs/concurrent-mode-suspense.html)ì„ 
í†µí•´ ì´ë¥¼ ë„ì…í•˜ë ¤ê³  ë…¸ë ¥ì¤‘ì´ë‹¤.
Reactì—ì„œ ê³µì‹ì ìœ¼ë¡œ ë°˜ì˜ë˜ì§€ëŠ” ì•Šì•˜ì§€ë§Œ, 
communityì—ì„œ ê³µìœ ë˜ê³  ìˆëŠ” ë°©ë²•ìœ¼ë¡œ Progressive Hydration êµ¬í˜„ì´ ê°€ëŠ¥í•˜ë‹¤.

Airbnbì—ì„œ Progressive Hydrationì„ ì ìš©í–ˆê³ , ì•„ë˜ì™€ ê°™ì´ TTIë¥¼ ê°œì„ í•œ ê²ƒì„ ì…ì¦í•˜ê¸°ë„ í–ˆë‹¤.

![Airbnb Progressive Hydration test result](./airbnb-test.jpg)

## Conclusion

ê·¸ë™ì•ˆ Web applicationì˜ Renderingì— ëŒ€í•´ ê³µë¶€í•˜ë©´ì„œ CSR, SSRì˜ ê°ê°ì˜ íŠ¹ì§•ë§Œ ë‹¨í¸ì ìœ¼ë¡œ ê³µë¶€í–ˆì—ˆë‹¤.
ì–‘ìª½ì˜ ì¥ì ì„ ì·¨í•©í•´ì„œ ë” ì¢‹ì€ ë°©ë²•ì„ ê³ ì•ˆí•´ë‚´ëŠ” ì´ì•¼ê¸°ë¥¼ ë“¤ìœ¼ë©° softwareê°€ ë°œì „í•˜ê²Œ ë˜ëŠ” ë‹¨ê³„ì— ëŒ€í•´ ê³ ë¯¼í•´ë³´ëŠ” ê¸°íšŒê°€ ë˜ì—ˆë‹¤.

ê¸°ì¡´ CSR, SSRì„ í†µí•´ êµ¬í˜„í–ˆë˜ applicationë“¤ì„ streaming ë˜ëŠ” progressive hydrationì„ ë„ì…í•´ë³´ê³ 
ì–¼ë§ˆë‚˜ ì„±ëŠ¥ì„ ê°œì„ ì„ ì–»ì„ ìˆ˜ ìˆëŠ”ì§€, ê·¸ ê³¼ì •ì—ì„œ ìƒëŠ” ì ì€ ì—†ëŠ”ì§€ í™•ì¸í•´ë´ì•¼ê² ë‹¤.

## Reference

[*Rendering on the Web: Performance Implications of Application Architecture*](https://youtu.be/k-A2VfuUROg)
